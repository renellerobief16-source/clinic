<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CASSANDRA CLINIC</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<!-- JsBarcode -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body { font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; flex-direction: column; margin: 0; }
#dashboardPage { display: flex; flex-direction: column; flex: 1; }
header { position: fixed; top: 0; left: 0; width: 100%; height: 70px; background: #343a40; color: white; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 1000; }
.sidebar { width: 220px; height: 100vh; position: fixed; top: 70px; left: 0; background: #343a40; padding-top: 20px; }
.sidebar a { display: flex; align-items: center; gap: 10px; padding: 12px 20px; color: white; text-decoration: none; border-radius: 5px; margin: 0.2em 0; transition: all 0.3s; }
.sidebar a.active, .sidebar a:hover { background: #495057; transform: translateX(5px); }
.main-content { margin-left: 220px; padding: 100px 20px 80px 20px; flex: 1; transition: all 0.3s; }
.content-section { display: none; }
.content-section.active { display: block; }
.card-stats { display: flex; gap: 20px; margin-bottom: 20px; }
.card-stats .card { flex: 1; }
footer { background: #343a40; color: white; text-align: center; padding: 10px 0; margin-top: auto; }
@media(max-width:768px){ .sidebar { width:100%; height:auto; position:relative; top:0; } .main-content { margin-left:0; padding:140px 10px 80px 10px; } }
#loginPage { display: flex; justify-content: center; align-items: center; flex-direction: column; background: #0d6efd; flex: 1; }
.login-card { background: white; padding: 2rem; border-radius: 15px; width: 100%; max-width: 400px; box-shadow: 0 0 15px rgba(0,0,0,0.3); }
.login-card h2 { text-align: center; margin-bottom: 1.5rem; }
.alert { display: none; }
</style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage">
  <div class="login-card">
    <h2>Cassandra Clinic</h2>
    <div class="alert alert-danger" id="loginAlert">Invalid credentials!</div>
    <form id="loginForm">
      <div class="mb-3">
        <label class="form-label">Username</label>
        <input type="text" class="form-control" id="username" placeholder="Enter username" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Password</label>
        <input type="password" class="form-control" id="password" placeholder="Enter password" required>
      </div>
      <button type="submit" class="btn btn-primary w-100">Login</button>
    </form>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboardPage" style="display:none;">
  <header>
    <div>CASSANDRA CLINIC</div>
    <button id="logoutBtn" class="btn btn-danger btn-sm">Logout</button>
  </header>

  <div class="sidebar">
    <a href="#" class="active" data-target="dashboardSection"><i class="bi bi-speedometer2"></i> Dashboard</a>
    <a href="#" data-target="patientsSection"><i class="bi bi-people"></i> Patients</a>
    <a href="#" data-target="appointmentsSection"><i class="bi bi-calendar2-check"></i> Appointments</a>
    <a href="#" data-target="doctorsSection"><i class="bi bi-person-badge"></i> Doctors</a>
    <a href="#" data-target="settingsSection"><i class="bi bi-gear"></i> Settings</a>
  </div>

  <div class="main-content">

    <!-- Dashboard Section -->
    <div id="dashboardSection" class="content-section active">
      <h2>Dashboard</h2>
      <div class="row mb-4">
        <div class="col-md-4"><div class="card text-bg-primary p-3"><h5>Total Patients</h5><p id="totalPatients">0</p></div></div>
        <div class="col-md-4"><div class="card text-bg-success p-3"><h5>Total Appointments</h5><p id="totalAppointments">0</p></div></div>
        <div class="col-md-4"><div class="card text-bg-warning p-3"><h5>Total Doctors</h5><p id="totalDoctors">0</p></div></div>
      </div>

      <!-- Analytics Chart Card -->
      <div class="card p-3">
        <h5>Analytics Overview</h5>
        <canvas id="analyticsChart" height="150"></canvas>
      </div>
    </div>

    <!-- Patients Section -->
    <div id="patientsSection" class="content-section">
      <h2>Patients</h2>

      <input type="text" id="barcodeSearch" class="form-control mb-3" placeholder="Scan barcode here...">
      <div id="patientResult"></div>

      <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#patientModal">+ Add Patient</button>

      <table class="table table-striped">
        <thead>
          <tr>
            <th>Barcode</th>
            <th>Name</th>
            <th>Age</th>
            <th>Gender</th>
            <th>Phone</th>
            <th>Username</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="patientTableBody"></tbody>
      </table>
    </div>

    <!-- Appointments Section -->
    <div id="appointmentsSection" class="content-section">
      <h2>Appointments</h2>
      <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#appointmentModal">+ Add Appointment</button>
      <table class="table table-striped">
        <thead><tr><th>Patient</th><th>Doctor</th><th>Date</th><th>Time</th><th>Actions</th></tr></thead>
        <tbody id="appointmentTableBody"></tbody>
      </table>
    </div>

    <!-- Doctors Section -->
    <div id="doctorsSection" class="content-section">
      <h2>Doctors</h2>
      <table class="table table-striped">
        <thead><tr><th>Name</th><th>Specialty</th><th>Phone</th></tr></thead>
        <tbody id="doctorTableBody"></tbody>
      </table>
    </div>

    <!-- Settings Section -->
    <div id="settingsSection" class="content-section">
      <h2>Settings</h2>
      <form id="settingsForm">
        <div class="mb-3"><label>Clinic Name</label><input type="text" id="clinicName" class="form-control" value="Cassandra Clinic"></div>
        <div class="mb-3"><label>Phone</label><input type="tel" id="clinicPhone" class="form-control" value="09503618848"></div>
        <div class="mb-3"><label>Theme</label>
          <select id="theme" class="form-select"><option>Light</option><option>Dark</option></select>
        </div>
        <button class="btn btn-success">Save Settings</button>
      </form>
    </div>

  </div>

  <footer>&copy; 2025 CASSANDRA CLINIC. All rights reserved.</footer>

  <!-- Patient Modal -->
  <div class="modal fade" id="patientModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="patientForm">
          <div class="modal-header"><h5>Add/Edit Patient</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
          <div class="modal-body">
            <input type="hidden" id="editPatientIndex">
            <div class="mb-3"><label>Name</label><input type="text" id="patientName" class="form-control" required></div>
            <div class="mb-3"><label>Age</label><input type="number" id="patientAge" class="form-control" required></div>
            <div class="mb-3"><label>Gender</label>
              <select id="patientGender" class="form-select" required>
                <option value="">Select</option><option>Male</option><option>Female</option>
              </select>
            </div>
            <div class="mb-3"><label>Phone</label><input type="tel" id="patientPhone" class="form-control" required></div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" type="submit">Save</button>
            <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Appointment Modal -->
  <div class="modal fade" id="appointmentModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="appointmentForm">
          <div class="modal-header"><h5>Add/Edit Appointment</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
          <div class="modal-body">
            <input type="hidden" id="editAppointmentIndex">
            <div class="mb-3"><label>Patient</label><input type="text" id="appointmentPatient" required class="form-control"></div>
            <div class="mb-3"><label>Doctor</label><input type="text" id="appointmentDoctor" value="Dr Cassandra" readonly class="form-control"></div>
            <div class="mb-3"><label>Date</label><input type="date" id="appointmentDate" required class="form-control"></div>
            <div class="mb-3"><label>Time</label><input type="time" id="appointmentTime" required class="form-control"></div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-success" type="submit">Save</button>
            <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// LOGIN
const demoUser = { username: "admin", password: "1234" };
document.getElementById("loginForm").addEventListener("submit", function(e){
  e.preventDefault();
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();

  const allUsers = [...patients.map(pt => ({username: pt.username, password: pt.password})), demoUser];

  const found = allUsers.find(x => x.username === u && x.password === p);

  if(found){
    document.getElementById("loginPage").style.display = "none";
    document.getElementById("dashboardPage").style.display = "flex";
    renderDoctors();
    renderPatients();
    renderAppointments();
    updateDashboardCounts();
  } else {
    document.getElementById("loginAlert").style.display = "block";
  }
});

// LOGOUT
document.getElementById("logoutBtn").addEventListener("click", () => {
  document.getElementById("dashboardPage").style.display = "none";
  document.getElementById("loginPage").style.display = "flex";
  document.getElementById("loginForm").reset();
  document.getElementById("loginAlert").style.display = "none";
});

// NAVIGATION
document.querySelectorAll('.sidebar a').forEach(link=>{
  link.addEventListener('click', e=>{
    e.preventDefault();
    document.querySelectorAll('.sidebar a').forEach(l=>l.classList.remove('active'));
    link.classList.add('active');

    document.querySelectorAll('.content-section').forEach(sec=>sec.classList.remove('active'));
    document.getElementById(link.dataset.target).classList.add('active');
  });
});

// DATA
let patients=[];
let appointments=[];
let doctors=[{ name:"Dr Cassandra", specialty:"Primary Care Doctor", phone:"0950371323" }];

function generatePatientID(){
  let id=""; for(let i=0;i<15;i++) id+=Math.floor(Math.random()*10); return id;
}

// RENDER DOCTORS
function renderDoctors(){
  const tbody=document.getElementById("doctorTableBody");
  tbody.innerHTML="";
  doctors.forEach(d=>{
    tbody.innerHTML+=`<tr><td>${d.name}</td><td>${d.specialty}</td><td>${d.phone}</td></tr>`;
  });
}

// RENDER PATIENTS
function renderPatients(){
  const tbody=document.getElementById("patientTableBody");
  tbody.innerHTML="";
  patients.forEach((p,i)=>{
    const row=document.createElement("tr");

    const barcode=document.createElement("img");
    JsBarcode(barcode, p.id, {format:"CODE128", width:2, height:60});

    row.innerHTML = `
      <td></td>
      <td>${p.name}</td>
      <td>${p.age}</td>
      <td>${p.gender}</td>
      <td>${p.phone}</td>
      <td>${p.username}</td>
      <td><button class="btn btn-sm btn-warning edit-btn">Edit</button></td>
    `;

    row.children[0].appendChild(barcode);

    row.querySelector(".edit-btn").addEventListener("click",()=>{
      document.getElementById("editPatientIndex").value=i;
      document.getElementById("patientName").value=p.name;
      document.getElementById("patientAge").value=p.age;
      document.getElementById("patientGender").value=p.gender;
      document.getElementById("patientPhone").value=p.phone;
      new bootstrap.Modal(document.getElementById("patientModal")).show();
    });

    tbody.appendChild(row);
  });
}

// ADD/EDIT PATIENT
document.getElementById("patientForm").addEventListener("submit", e=>{
  e.preventDefault();

  const index = document.getElementById("editPatientIndex").value;
  const fullName = document.getElementById("patientName").value.trim();

  // Auto-generate username
  const username = fullName.toLowerCase()
    .replace(/\s+/g, ".")
    .replace(/[^a-z.]/g, "");

  const patient = {
    id: index !== "" ? patients[index].id : generatePatientID(),
    name: fullName,
    age: document.getElementById("patientAge").value,
    gender: document.getElementById("patientGender").value,
    phone: document.getElementById("patientPhone").value,
    username: username,
    password: "1234"
  };

  if(index !== "") patients[index] = patient;
  else patients.push(patient);

  e.target.reset();
  document.getElementById("editPatientIndex").value = "";
  renderPatients();
  updateDashboardCounts();
});

// RENDER APPOINTMENTS
function renderAppointments(){
  const tbody=document.getElementById("appointmentTableBody");
  tbody.innerHTML="";
  appointments.forEach((a,i)=>{
    const row=document.createElement("tr");
    row.innerHTML=`<td>${a.patient}</td><td>${a.doctor}</td><td>${a.date}</td><td>${a.time}</td>
      <td>
        <button class="btn btn-sm btn-warning edit-btn">Edit</button>
        <button class="btn btn-sm btn-danger delete-btn">Delete</button>
      </td>`;
    row.querySelector(".edit-btn").addEventListener("click",()=>{
      document.getElementById("editAppointmentIndex").value=i;
      document.getElementById("appointmentPatient").value=a.patient;
      document.getElementById("appointmentDoctor").value=a.doctor;
      document.getElementById("appointmentDate").value=a.date;
      document.getElementById("appointmentTime").value=a.time;
      new bootstrap.Modal(document.getElementById("appointmentModal")).show();
    });
    row.querySelector(".delete-btn").addEventListener("click",()=>{
      if(confirm("Delete appointment?")){
        appointments.splice(i,1);
        renderAppointments();
        updateDashboardCounts();
      }
    });
    tbody.appendChild(row);
  });
}

// ADD/EDIT APPOINTMENT
document.getElementById("appointmentForm").addEventListener("submit", e=>{
  e.preventDefault();
  const index = document.getElementById("editAppointmentIndex").value;
  const appointment = {
    patient: document.getElementById("appointmentPatient").value,
    doctor: document.getElementById("appointmentDoctor").value,
    date: document.getElementById("appointmentDate").value,
    time: document.getElementById("appointmentTime").value
  };
  if(index !== "") appointments[index] = appointment;
  else appointments.push(appointment);
  e.target.reset();
  document.getElementById("editAppointmentIndex").value = "";
  renderAppointments();
  updateDashboardCounts();
});

// SEARCH BY BARCODE
document.getElementById("barcodeSearch").addEventListener("input", e=>{
  const val=e.target.value;
  const resultDiv=document.getElementById("patientResult");
  resultDiv.innerHTML="";
  const found = patients.find(p=>p.id===val);
  if(found) resultDiv.innerHTML=`Found: ${found.name}, ${found.age} yrs, ${found.gender}`;
});

// Analytics Chart
const ctx = document.getElementById('analyticsChart').getContext('2d');
const analyticsChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ['Patients', 'Appointments', 'Doctors'],
        datasets: [{
            label: 'Count',
            data: [patients.length, appointments.length, doctors.length],
            backgroundColor: [
                'rgba(13,110,253,0.7)',
                'rgba(25,135,84,0.7)',
                'rgba(255,193,7,0.7)'
            ],
            borderColor: [
                'rgba(13,110,253,1)',
                'rgba(25,135,84,1)',
                'rgba(255,193,7,1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false }, title: { display: true, text: 'Current Statistics' } },
        scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }
    }
});

function updateDashboardCounts(){
  document.getElementById("totalPatients").textContent=patients.length;
  document.getElementById("totalAppointments").textContent=appointments.length;
  document.getElementById("totalDoctors").textContent=doctors.length;

  analyticsChart.data.datasets[0].data = [patients.length, appointments.length, doctors.length];
  analyticsChart.update();
}
</script>

</body>
</html>
